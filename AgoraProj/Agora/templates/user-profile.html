{% extends "master.html" %}
{% load static %}
{% load account %}

{% block css %}
    <link rel="stylesheet" href="{% static 'home/dashboard.css' %}">
    <script type="module" src="{% static 'js/toggle.js' %}"></script>
    <script type="module" src="{% static 'js/search.js' %}"></script>
    <link href="https://fonts.googleapis.com/css2?family=Croissant+One&display=swap" rel="stylesheet">  
{% endblock %}

{% block content %}
{% include "modal/edit-userprofile.html" %}
    
<div id="root">
        {% if request.user.is_authenticated %}
    <!-- 
            <h1> Welcome, {{ request.user.username }}!</h1>
            <a href="{% url 'account_logout' %}">Sign Out</a>
        
        -->
        {% include "nav.html" %}

        <div class="NCenter">
                <div class="Profile-Container">
                    <div class="PPC-Cover-Container">
                        <input id="accountID" type="text" value="{{ accountInfo.id }}"  style="display:none" ;>
                        {% if accountInfo.cover_photo %}
                            <img id="UserCoverPhoto" src="{{ accountInfo.cover_photo }}">
                        {% else %}
                            <img id="UserCoverPhoto" src="../static/images/default-coverphoto1.jpg">
                        {% endif %}
                    
                        <div class="PPC-Profile-Cont">
                            <div class="PPC-My-Profile">
                                <img src="{{ accountInfo.profile_photo }}">
                            </div>
                                <div class="PPC-Buttons">
                                    <div class="PPCB-Top">
                                    </div>
                                    <div class="PPCB-Bottom">
                                        {% if accountInfo.bio %}
                                        <div class="Bio-Div"><p>" {{ accountInfo.bio }} "</p></div>
                                        <button id="Edit-MyProfile">Edit Profile</button>
                                        {% else %}
                                        <div class="Bio-Div"><p>" Click Edit to Input Bio "</p></div>
                                        <button id="Edit-MyProfile">Edit Profile</button>
                                        {% endif %}
                                    </div>
                                </div>
                        </div>  
                    </div>

                    <div class="OnePurpose-Container"></div>
                    
                    <div class="PPC-ProfInfo-Cont">
                        <div class="PPC-Info-Left"></div>
                        <div class="PPC-Info-Mid">
                            {% if accountInfo %}
                            <h2>{{ accountInfo.firstname }} {{ accountInfo.lastname }}</h2>
                            {% endif %}
                        
                            <p>@{{ request.user.username }}</p>
                            <p>Joined {{ request.user.date_joined|date:"F j, Y" }}</p>
                        </div>
                    </div>

                    <div class="MyProfile-Nav">
                        <ul>
                            <li>About</li>
                        </ul>
                    </div>
                    <div class="UserProf-Main">
                        
                        <div class="User-About-Prof">

                            <div class="UBF-Content">
                                <h1>Other Information</h1>
                                <p>Birthdate: {{ accountInfo.Birthday }}</p>
                            </div>

                            <div class="UBF-Gallery"></div>
                        </div>

                        <div class="NCenter-content-user">
                            <div class="Post-Container2">
                                <div class="PC-Left">
                                    <div class="PCL-Top">
                                        {% if is_new_user %}
                                            <img src="../static/images/default-profile2.jpg" alt="{{ request.user.username }}">
                                        {% else %}
                                            <img src="{{ accountInfo.profile_photo }}">
                                        {% endif %}
                                    </div>
                                </div>
                                <p id="currentUserId" data-userId="{{ accountInfo.id }}"></p>
                                <div class="PC-Right">
                                    <div class="PCR-Top">
                                        <input type="text" id="create-post" placeholder="Tell your friends about your thoughts">
                                    </div>
                                
                                </div>
                            </div>
                            
                            {% if posts.posts_with_photos %}
                                {% for post, photos in posts.posts_with_photos.items %}
                                    <div class="User-Post-Container2">
                                        <div class="UPC-content-Top">
                                            <div class="UPCCT-Left">
                                                <a href="profile/{{ post.account.id }}">
                                                    <div class="Post-Prof-Cont">
                                                        <img src="{{ post.account.profile_photo }}">
                                                    </div>
                                                </a>
                                                <div class="Post-Prof-Cont2">
                                                    <div id="Post-Prof-Cont-Name1" class="Post-Prof-Cont-Name">
                                                        <a href="profile/{{ post.account.id }}">
                                                            <p class="Photo-Post-username">{{ post.account.firstname }}</p>
                                                        </a>
                                                        <p class="Post-Photo-Date-Time">{{ post.time_ago }}</p>
                                                    </div>
                                                    <div class="Post-Prof-Cont-Username">
                                                        <p>@{{ post.account.auth_user.username }}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="UPCCT-Right">
                                            </div>
                                        </div>
                    
                                        {% if photos %}
                                        <div class="UPC-content-grid {% if photos|length == 3 %}three-photos{% endif %}">
                                            {% for photo in photos %}
                                                <div class="UPC-content {% if photos|length == 1 %}single-photo{% endif %}">
                                                    <img src="{{ photo.link|add:'?cm-pad_resize,bg-F3F3F3' }}" alt="">
                                                </div>
                                            {% endfor %}
                                        </div>
                                        {% else %}
                                        <div class="UPCB-Tags" style="height: 2rem"></div>
                                        {% endif %}
                    
                                        <div class="UPC-content-Bottom">
                                            <div class="UPCB-Caption">
                                                <div class="Cap-User">
                                                    <p>{{ post.account.firstname }}</p>
                                                </div>
                                                <div class="Cap-Caption">
                                                    <p class="postCaption">{{ post.caption }}</p>
                                                    <br>
                                                </div>
                                            </div>
                                            <div class="UPCB-Tags">
                                                {% for tag in post.tags.all %}
                                                    <a href="/tags/{{ tag.id }}"><div><span class="hashtags">#{{ tag.tag }}</span></div></a>
                                                {% endfor %}
                                            </div>
                                            <div class="UPCB-Reacts">
                                                <div class="Reacts">
                                                    <div class="GlowReact-Div" data-PostIDD="{{ post.id }}" data-AccID="{{ post.account.id }}">
                                                        {% if post.has_liked %}
                                                            <span class="ChangeGlow">&#10022;</span>
                                                        {% else %}
                                                            <img class="glow-react" src="../static/images/glow4.png" alt="Glow">
                                                        {% endif %}
                                                    </div>
                                                    <div class="React-Div Comment-Btn-Show" data-PostID="{{ post.id }}">
                                                        <img src="../static/images/chat (2).png" alt="">
                                                    </div>
                                                </div>
                                                <div class="React-Counts">
                                                    <div class="glow-count">
                                                        {% if post.glows_count > 1 %}
                                                            <p>{{ post.glows_count }} glows</p>
                                                        {% else %}
                                                            <p>{{ post.glows_count }} glow</p>
                                                        {% endif %}
                                                    </div>
                                                    <div class="Comments">
                                                        {% if post.comment_count > 1 %}
                                                            <p>{{ post.comment_count }} comments</p>
                                                        {% else %}
                                                            <p>{{ post.comment_count }} comment</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}

                                {% else %}
                                <p> No posts yet</p>
                            {% endif %}
                        </div>

                    </div>
                    
        
                </div>
        </div>

        {% include "nav-right.html" %}
        
        <div id="messages"></div>
    {% endif %}
</div>
<script>
    let EditMyProfile = document.getElementById('Edit-MyProfile');
    let EditProfileOverlay = document.getElementById('EditProfile-Overlay');
    let EditProfileContainer = document.getElementById('EditProfile-Container');

    EditMyProfile.addEventListener('click', function(){
        EditProfileOverlay.style.display = "flex";
        event.stopPropagation();
    })

    document.addEventListener('click', function(event) {
        if(!EditProfileContainer.contains(event.target)){
            EditProfileOverlay.style.display = "none";
        }
    
    });
    
</script>

{% endblock %}
